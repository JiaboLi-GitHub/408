# 第1章 应用层

# 第2章 传输层

## 2.1 TCP

### 2.1.1 报文格式

![img](file:///C:/Users/LJB/AppData/Local/Temp/enhtmlclip/20170227111849763.gif)

总共4*5个字节

**1、源端口号**

**2、目的端口号**

**3、序号**seq：本报文第一个字节位于字节流中的位置

**4、确认号** ack：期望收到对方下一个报文段的序号

**5、数据偏移** ：表示TCP报文中的数据部分的位置，以4字节为一个单位

**6、保留字段** ：保留到今后使用，目前应置为0

**7、标志字段** 占6比特，每个比特都代表特定的含义 

（1）紧急位URG 

​	标志紧急指针是否有效 

（2）确认位ACK 

​	标志确认号是否有效 

（3）推送位PSH 

​	是否立刻将报文提交给应用程序，而不等到整个缓存都填满了后再向上交付 

（4）复位RST 

​	RST=1时说明连接出现问题，连接将被终止 

（5）同步位SYN 

​	在建立连接时的同步序号   当SYN=1 ACK=0，表示这是一个连接请求报文段   当SYN=1 ACK=1，表示对方同意建立连接 

（6） 终止位FIN 

​	用来释放一个连接   当FIN=1时，表明报文段的发送方的数据已经发送完毕，并要求释放运输连接。

**8、窗口大小**  指的是发送本报文段的一方的接收窗口大小。即允许对方发送的数据量。

**9、校验和**  检测数据是否出错

**10、紧急指针** 紧急指针给出紧急数据距离当前序号的偏移量 紧急数据字节号=TCP报文序号+紧急指针−1

**11、选项** 选项字段长度是可变的，最长可达40字节 当没有选项时，TCP首部长度为20字节

### 2.1.2 特点

**面向连接**

​	三次握手

​	四次挥手

**可靠传输**：保证接收方进程从缓存区读出的字节流与发送方发出的字节流是完全一样的。

​	校验

​	序号

​	确认

​	重传

**流量控制**

**拥塞控制**（全局性）

​	慢开始

​	拥塞避免

​	快重传

​	快恢复



#### 一、面向连接

**三次握手**

![8fc94a5517e9c33c06583f23d5e2a7a](E:/学习资料/笔记/Typora/资源/8fc94a5517e9c33c06583f23d5e2a7a.png)

**第一次：**

客户端发送连接请求报文段，无应用层数据。

SYN=1，seq=x（随机）

**第二次：**

服务端为该TCP连接分配缓存和变量，并向客户端返回确认报文段，允许连接，无应用层数据。

SYN=1，ACK=1,seq=y（随机）,ack=x+1

**第三次：**

客户端为该TCP连接分配缓存和变量，并向服务端返回确认的确认，可以携带信息。

SYN=0，ACK=1，seq=x+1，ack=y+1



**四次挥手**

![bea02c4fc2307d0c2d518a3d05201c0](E:\学习资料\笔记\Typora\资源\bea02c4fc2307d0c2d518a3d05201c0.png)

**第一次：**

客户端发送连接释放报文段，停止发送数据，主动关闭TCP连接。

FIN=1,seq=u

**第二次：**

服务端回送一个确认报文段，客户端到服务器这个方向的连接就释放了--半关闭状态

ACK=1,seq=v,ack=u+1

**第三次：**

服务端发完数据，就发出连接释放报文段，主动关闭TCP连接。

FIN=1,ACK=1,seq=w，ack=u+1

**第四次：**

客户端回送一个确认报文段，再等待2MSL（最长报文段寿命）后，连接彻底关闭。

ACK=1,seq=u+1,ack=w+1

#### 二、可靠传输

#### 三、流量控制

​	TCP利用滑动窗口机制实现流量控制。

​	在通讯过程中，接收方根据自己接收缓存的大小，动态的调节发送给发送端的报文中窗口字段。

#### 四、拥塞控制

发送窗口=min{发送窗口，拥塞窗口}

接收窗口：接收方根据接受缓存设置的值，并告知发送方，反映接收方容量。

拥塞窗口：发送方根据自己估算的网络拥塞程度而设置的窗口值，反应网络当前容量

**慢开始对应拥塞控制**

**快重传对应快恢复**

![335dfdecb7b8bc7ee82c612dd4a62c5](E:\学习资料\笔记\Typora\资源\335dfdecb7b8bc7ee82c612dd4a62c5.png)

## 2.2 UDP

### 2.2.1 传输层的寻址与端口

应用程序		FTP文件传输		SMTP		   DNS			TFTP文件传输	HTTP

熟知端口号			21					25				53				69						80